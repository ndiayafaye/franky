var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ImageDetailSwipe,__assign,Multimedia;(function(n){var t;(function(t){var r=MmGeometry.Rectangle,u=n.ImageDetailUtils.setCropBoxAnimationProperty,f=n.ImageDetailUtils.isRTL,e=n.ImageDetailUtils.calculateRegionDifference,i=ImageDetailReducers,o="undefined",s=function(o){function s(t){var u=o.call(this,t)||this;return u.px="px",u.startAnimationClassName="start",u.endAnimationClassName="end",u.readyAnimationClassName="ready",u.cropboxHintShown="mm.detail.crophint",u.cropBoxContentAnimationTime=1e3,u.cropBoxHintAnimationTime=3500,u.lastCropCoordinates=null,u.cropBoxAnimationTime=null,u.shouldShowHint=!1,u.isCropping=!1,u.multiTouchMove=!1,u.containerHeight=null,u.containerWidth=null,u.hint=null,u.cropConfig=null,u.hasTouchStartTriggered=!1,u.enableLiveView=null,u.debounceDelay=100,u.componentWillUnmount=function(){u.setSessionStorage();u.handleEventsSetting(!1)},u.isSessionStorageEnabled=function(){var n=!1;try{n="object"==typeof _w.sessionStorage}catch(t){}return n},u.setSessionStorage=function(){u.shouldShowHint&&u.isSessionStorageEnabled()&&(sessionStorage.setItem(u.cropboxHintShown,"1"),u.shouldShowHint=!1)},u.getViewRect=function(){if(!u.imageElement)return null;var n=u.imageElement.clientLeft,t=u.imageElement.clientTop,i=Math.min(u.imageElement.clientWidth,u.containerWidth),f=Math.min(u.imageElement.clientHeight,u.containerHeight),e={x:n,y:t},o={x:n+i,y:t+f};return new r(e,o)},u.getCropRect=function(n){if(!u.imageElement)return null;var o=u.imageElement.clientLeft,s=u.imageElement.clientTop,t=Math.min(u.imageElement.clientWidth,u.containerWidth),i=Math.min(u.imageElement.clientHeight,u.containerHeight),f=o+Math.round(t*n.left()),e=s+Math.round(i*n.top()),h=f+Math.round(t*n.width()),c=e+Math.round(i*n.height()),l={x:f,y:e},a={x:h,y:c};return new r(l,a)},u.start=function(n){u.overlayView!=null&&(u.startCropRect=u.overlayView.cropRect().clone(),u.overlayView.setStartPoint(n))},u.move=function(n){u.overlayView!=null&&u.startCropRect!=null&&(u.overlayView.setCurrPoint(n),u.overlayView.setCropRect(u.startCropRect.clone()),u.overlayView.update(),u.updateCropBoxStyle())},u.end=function(){u.throttleCropBoxChange()},u.cropBoxChange=function(){var n=u.getCropCoordinates(),t;n==null||u.isTinyChange(u.lastCropCoordinates,n)||(t={left:n.left(),top:n.top(),right:n.right(),bottom:n.bottom()},u.lastCropCoordinates=n,u.props.changeCropCoordinates(t))},u.setCropBoxState=function(n,t){u.startCropRect=new r(n,t);u.overlayView.setCropRect(u.startCropRect);u.overlayView.setStartPoint(n);u.overlayView.setCurrPoint(n);u.overlayView.update();u.updateCropBoxStyle()},u.updateCropBoxStyle=function(){if(u.overlayView!=null){var n=u.overlayView.cropRect();u.update(n)}},u.getCropCoordinates=function(){var i,t,n,f,e;return u.overlayView!=null&&(t=u.overlayView.cropRect(),n=u.overlayView.viewRect(),n.width()>0&&n.height()>0&&(f={x:t.left()/n.width(),y:t.top()/n.height()},e={x:t.right()/n.width(),y:t.bottom()/n.height()},i=new r(f,e))),i},u.isTinyChange=function(n,t){if(u.overlayView!=null&&u.overlayView.cropRect()!=null&&u.overlayView.cropRect().width()<=u.config.minDelta&&u.overlayView.cropRect().height()<=u.config.minDelta)return!0;if(n&&t){var i=e(n.transformToRegion(),t.transformToRegion());if(i<u.config.minDelta)return!0}return!1},u.throttle=function(n,t){var i,r;return function(){clearTimeout(r);var f=this,e=arguments,u=Number(new Date);i&&u<i+t?r=setTimeout(function(){i=u;n.apply(f,e)},i+t-u):(i=u,n.apply(f,e))}},u.cancelAnimation=function(n){n&&(n.classList.remove(u.startAnimationClassName),n.classList.add(u.endAnimationClassName))},u.startAnimation=function(n){n&&(n.classList.add(u.readyAnimationClassName),u.isAnimationEnabled()&&n.classList.add(u.startAnimationClassName))},u.endAnimation=function(n,t){if(n){var i=u.cancelAnimation;u.isAnimationEnabled()?setTimeout(function(){i(n)},t):u.cancelAnimation(n)}},u.setAnimations=function(){u.startAnimation(u.cropBox);u.startAnimation(u.cropBoxContent);u.startAnimation(u.cropBoxHint);u.endAnimation(u.cropBox,u.cropBoxAnimationTime);u.endAnimation(u.cropBoxContent,u.cropBoxContentAnimationTime);u.endAnimation(u.cropBoxHint,u.cropBoxHintAnimationTime)},u.update=function(n){if(u.cropBox&&n){var i=n.top(),t=n.left(),r=n.height(),e=n.width();f?u.cropBox.style.right=t+u.px:u.cropBox.style.left=t+u.px;u.cropBox.style.top=i+u.px;u.cropBox.style.width=e+u.px;u.cropBox.style.height=r+u.px;u.ImageCropBoxPin&&u.ImageCropBoxPin.setStyle(i,t,r,e)}},u.getOffsetPosition=function(n,t,i){var r=n.getBoundingClientRect(),u=t-r.left,f=i-r.top;return{x:u,y:f}},u.getTouchPosition=function(n,t){return n&&n.touches?u.getOffsetPosition(u.imageElement,n.touches[t].clientX,n.touches[t].clientY):null},u.getMousePosition=function(n){return u.getOffsetPosition(u.imageElement,n.clientX,n.clientY)},u.onTouchStart=function(n){if(u.hasTouchStartTriggered=!0,n&&n.touches)u.start(u.getTouchPosition(n,0));else u.onMouseDown(n);u.enableLiveView&&u.props.changeInsightsScrollPosition()},u.onMouseDown=function(n){if(u.isPositionWithinBoundary(u.imageElement,n.clientX,n.clientY)){u.isCropping=!0;var t=u.getMousePosition(n);u.start(t)}},u.onTouchMove=function(n){if(n&&n.touches)if(u.config.enableMultiTouchRedraw&&n.touches.length>=2){u.multiTouchMove=!0;var t=u.getTouchPosition(n,0),i=u.getTouchPosition(n,1);u.setCropBoxState(t,i);u.stopPropagation(n)}else!u.multiTouchMove&&u.overlayView.isTransforming()&&(u.move(u.getTouchPosition(n,0)),u.stopPropagation(n));else u.onMouseMove(n)},u.onMouseMove=function(t){var i,r,f;u.isCropping&&(i=u.getMousePosition(t),u.overlayView.isTransforming()?u.move(i):u.config.enableMouseRedraw&&(r={x:i.x,y:i.y},f={x:i.x+1,y:i.y+1},u.setCropBoxState(r,f)),u.props.inTextMode&&u.debouncedOCRIntersectionsChangeHandler(n.TextRecognitionUtils.getSelectedArea(u.overlayView.cropRect(),u.overlayView.viewRect())),u.stopPropagation(t))},u.onTouchEnd=function(n){if(n&&n.touches)u.end(),n.touches.length===0&&(u.multiTouchMove=!1),u.stopPropagation(n);else u.onMouseUp(n);u.hasTouchStartTriggered=!1},u.onDocumentTouchEnd=function(n){if(u.hasTouchStartTriggered)u.onTouchEnd(n)},u.onMouseUp=function(){if(u.isCropping=!1,typeof _w!="undefined"){var n=_w.getSelection();n&&n.type=="Range"&&n.removeAllRanges()}u.overlayView.verifyMinimumSize();u.end()},u.isPositionWithinBoundary=function(n,t,i){var r=n.getBoundingClientRect();return t<r.left||t>r.right||i<r.top||i>r.bottom?!1:!0},u.handleEventsSetting=function(n){var t=n?sj_be:sj_ue;"ontouchstart"in sb_de?(t(u.imageElement,"touchstart",u.onTouchStart,!0),t(u.imageElement,"touchmove",u.onTouchMove,!0),t(u.imageElement,"touchend",u.onTouchEnd,!0)):window.navigator.msPointerEnabled?(u.imageElement.style.msTouchAction="none",u.imageElement.style.touchAction="none",t(u.imageElement,"MSPointerDown",u.onTouchStart,!0),t(u.imageElement,"MSPointerMove",u.onTouchMove,!0),t(u.imageElement,"MSPointerUp",u.onTouchEnd,!0),t(_d,"MSPointerUp",u.onDocumentTouchEnd,!0)):"onpointermove"in sb_de&&(u.imageElement.style.msTouchAction="none",u.imageElement.style.touchAction="none",t(u.imageElement,"pointerdown",u.onTouchStart,!0),t(u.imageElement,"pointermove",u.onTouchMove,!0),t(u.imageElement,"pointerup",u.onTouchEnd,!0),t(_d,"pointerup",u.onDocumentTouchEnd,!0));t(u.imageElement,"mousedown",u.onMouseDown,!0);t(u.imageElement,"mousemove",u.onMouseMove,!0);t(u.imageElement,"mouseup",u.onMouseUp,!0)},u.enableLiveView=typeof i.ilv!="undefined"?i.ilv():!1,u.cropConfig=i.getCropConfig(),u.shouldShowHint=!u.cropConfig.eft&&u.isSessionStorageEnabled()&&sessionStorage.getItem(u.cropboxHintShown)!=="1",u.hint=u.cropConfig.hnt,u.debouncedOCRIntersectionsChangeHandler=n.ImageDetailUtils.debounce(u.props.changeIntersectedOCRRegions,u.debounceDelay),u}return __extends(s,o),s.prototype.componentWillMount=function(){this.props&&(this.config=new ImageVisualSearchCropBox.CropBoxClientConfig(this.cropConfig),this.isCropping=this.props.isDirectDrawing,this.cropBoxAnimationTime=this.config.animationDuration,this.containerWidth=this.props.containerWidth,this.containerHeight=this.props.containerHeight)},s.prototype.componentDidMount=function(){var t,i,f,n;this.throttleCropBoxChange=this.throttle(this.cropBoxChange,this.config.eventTimeThreshold);t=this.props.cropCoordinates?this.props.cropCoordinates:this.config;this.isCropping&&this.props.dragEvent?(f=this.getMousePosition(this.props.dragEvent),i=new r({x:f.x,y:f.y},{x:f.x+this.config.minDelta,y:f.y+this.config.minDelta}),this.overlayView=new VisualSearchCropBoxUtils.OverlayView(this.getViewRect(),i,this.config)):(i=new r({x:t.left,y:t.top},{x:t.right,y:t.bottom}),this.overlayView=new VisualSearchCropBoxUtils.OverlayView(this.getViewRect(),this.getCropRect(i),this.config));n=this.overlayView.cropRect();n&&u(n.width(),n.height(),n.left(),n.top());this.isAnimationEnabled()?setTimeout(this.updateCropBoxStyle,this.cropBoxAnimationTime):this.updateCropBoxStyle();this.setAnimations();this.props.cropCoordinates?this.lastCropCoordinates=i:this.throttleCropBoxChange();this.handleEventsSetting(!0)},s.prototype.componentWillReceiveProps=function(n){if(n.cropCoordinates&&this.overlayView!=null){var t=new r({x:n.cropCoordinates.left,y:n.cropCoordinates.top},{x:n.cropCoordinates.right,y:n.cropCoordinates.bottom});t.equals(this.lastCropCoordinates)&&this.containerHeight==n.containerHeight&&this.containerWidth==n.containerWidth||(this.overlayView.setViewRect(this.getViewRect()),this.overlayView.setCropRect(this.getCropRect(t)),this.lastCropCoordinates=t,this.updateCropBoxStyle(),this.containerHeight=n.containerHeight,this.containerWidth=n.containerWidth,this.setState({coordinates:t,containerHeight:n.containerHeight,containerWidth:n.containerWidth}))}},s.prototype.isAnimationEnabled=function(){return this.config.enableAnimations&&!this.props.isFromOverlayElement&&!this.props.isDirectDrawing},s.prototype.isCloseButtonEnabled=function(){return this.config.enableCloseButton},s.prototype.stopPropagation=function(n){n.preventDefault();n.stopPropagation()},s.prototype.render=function(){var i=this,r="cropRect";return(r+=this.isCloseButtonEnabled()?" rb":"",this.props)?React.createElement("div",{id:"overlay_view",className:"overlayView",ref:function(n){i.imageElement=n}},this.enableLiveView&&React.createElement(n.ImageDetail.ImageCropBoxPin,{setMainImageVerticalScroll:this.props.setMainImageVerticalScroll,ref:function(n){i.ImageCropBoxPin=n}}),React.createElement("div",{id:"crop_rect",className:r,ref:function(n){i.cropBox=n}},React.createElement("div",{className:"content",ref:function(n){i.cropBoxContent=n}},React.createElement("div",{className:"left"}),React.createElement("div",{className:"right"}),React.createElement("div",{className:"top"}),React.createElement("div",{className:"bottom"}),React.createElement("div",{className:"leftTop"}),React.createElement("div",{className:"rightTop"}),React.createElement("div",{className:"leftBottom"}),React.createElement("div",{className:"rightBottom"}),this.isCloseButtonEnabled()&&React.createElement(t.RemoveCropAction,{hideText:!0}))),this.shouldShowHint&&React.createElement("span",{className:"cropBoxHint",ref:function(n){i.cropBoxHint=n}},this.hint)):null},s}(React.Component),h=function(n){return{changeCropCoordinates:function(t){t&&n(ImageDetailActions.changeCropCoordinates(t))},changeInsightsScrollPosition:function(){n(ImageDetailActions.changeInsightsScrollPosition(ImageDetailActions.InsightsScrollPosition.Peek))},changeIntersectedOCRRegions:function(t){typeof ImageDetailActions.changeIntersectedTextRegions!=o&&n(ImageDetailActions.changeIntersectedTextRegions(t))}}},c=function(n){var r=i.getIsHotspotClick(n)||i.getClickedEntity(n),t=i.gdlc("gtrc");return{cropCoordinates:i.getCropCoordinates(n),isFromOverlayElement:!!r,inTextMode:t&&t.e?i.getTextMode(n):!1}},l=ReactRedux.connect(c,h);t.ImageCropBox=l(s)})(t=n.ImageDetail||(n.ImageDetail={}))})(Multimedia||(Multimedia={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}();__assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)},function(n){var t;(function(){var o=n.InstrumentationUtils.lac,s=ImageDetailReducers.getResourceString,h=ImageDetailActions.IImageDetailViewType,f=n.ImageDetailUtils.InsightsModuleType,c=ImageDetailActions.IImageDetailOverlayElement,e=ImageDetailActions.IClickTarget,i=ImageDetailActions.EventActionType,t=ImageDetailReducers,u=n.ImageDetailUtils,r="undefined",l=function(f){function h(h){var c=f.call(this,h)||this;return c.hotSpots=[],c.defaultHoverShown=!1,c.hotSpotTooltip=null,c.handleSyntheticClick=function(n){if(n.detectedObjects&&n.detectedObjects.length>0){var t=0;typeof u.ghtptla=="function"&&n.detectedObjects.length>1&&(t=u.ghtptla(n.detectedObjects));c.handleClickOnHotSpotElement(n.detectedObjects[t],t)}typeof i!==r&&n.changeEnableSyntheticHotspotClick(i.Completed)},c.changeCropCoordinatesAndLoadVisualSearch=function(n,t){if(n){c.props.changeCropCoordinates(n);c.enableClickChangeHiddenCrop&&c.props.changeHiddenCropCoordinates(n);c.props.changeSelectedModule(c.props.enableAllTabOnClick);c.props.changeSelectedObjectIndex(t);var i=ImageDetailActions.IImageDetailViewType.VisualSearch;c.enableClickChangeHiddenCrop||c.props.viewType===i||(c.props.addToDetailStateHistory(),c.props.changeInsightsStatus(c.props.ig),c.props.changePageView())}},c.stopPropagation=function(n){n.stopPropagation();n.preventDefault()},c.handleUserAction=function(n,t){c.stopPropagation(n);c.handleClickOnHotSpot(t)},c.handleClickOnHotSpot=function(n){var t=c.props.detectedObjects[n];c.handleClickOnHotSpotElement(t,n)},c.handleClickOnHotSpotElement=function(t,i){var r=t&&t.boundingBox,f,s,h;if(r){f=t.hotspot;s=f?"left:"+f.left+", top:"+f.top:"";c.props.imageData&&c.props.imageData.instInfo&&o("ObjectDetectionHotSpot",c.props.ig,{Info:s},c.props.imageData.instInfo);switch(c.clickTarget){case e.External:h={result:c.props.imageData,insightsViewState:{viewType:ImageDetailActions.IImageDetailViewType.VisualSearch},cropcoordinates:{top:r.top,bottom:r.bottom,left:r.left,right:r.right}};u.gecc(n.ImageDetailLocationUtils.getSearchByImageUploadUrl(h,!0))();break;default:c.changeCropCoordinatesAndLoadVisualSearch(r,i)}}},c.hotSpotTooltip=s("HSTooltip"),c.enableClickChangeHiddenCrop=t.gpc().echcr,c.clickTarget=h.config?h.config.ClickTarget:e.DetailPage,c}return __extends(h,f),h.prototype.componentDidMount=function(){typeof i!==r&&this.props.syntheticClick===i.Requested&&this.handleSyntheticClick(this.props)},h.prototype.componentWillUpdate=function(){this.hotSpots=[]},h.prototype.componentWillReceiveProps=function(n){typeof i!==r&&n.syntheticClick===i.Requested&&this.props.syntheticClick===i.None&&this.handleSyntheticClick(n)},h.prototype.componentDidUpdate=function(){if(this.props.setMainImageVerticalScroll&&typeof u.getOverlap!=r&&this.hotSpots&&this.hotSpots.length>0&&this.props.selectedObjectIndex>=0){var n=u.getOverlap(this.hotSpots[this.props.selectedObjectIndex],_d.querySelector(".img_bop"));console.log("selectedObjectIndex: "+this.props.selectedObjectIndex);console.log("overlap with selectedOgject: "+n);n>0&&this.props.setMainImageVerticalScroll(-n)}},h.prototype.render=function(){var n=this;if(this.props&&this.props.config&&this.props.config.Enabled&&this.props.detectedObjects&&this.props.detectedObjects.length>0){var t=this.props.config.EnableTooltip?this.hotSpotTooltip:"",i=t?{"data-tooltip":t}:{},r=this.props.showHotspotWithoutHover?"obj_det_container show":"obj_det_container";return React.createElement("div",{className:r,id:"obj_det_container"},this.props.detectedObjects.map(function(t,r){var u,f;if(t.hotspot)return u=r==0&&n.props.config.EnableNotification&&!n.defaultHoverShown?"obj_det hover":"obj_det",u+=r===n.props.selectedObjectIndex?" selected":"",f={left:t.hotspot.left*100+"%",top:t.hotspot.top*100+"%"},React.createElement("span",__assign({},i,{className:u,key:r,style:f,onMouseDown:function(t){return n.handleUserAction(t,r)},onTouchEnd:function(t){return n.handleUserAction(t,r)},ref:function(t){t&&n.hotSpots.push(t)}}),React.createElement("span",{className:"core"}))}))}return null},h}(React.Component),a=function(n){return{changeCropCoordinates:function(t){n(ImageDetailActions.changeCropCoordinates(t,!0))},changeHiddenCropCoordinates:function(t){typeof ImageDetailActions.changeHiddenCropCoordinates!=r&&n(ImageDetailActions.changeHiddenCropCoordinates(t))},addToDetailStateHistory:function(){n(ImageDetailActions.addToDetailStateHistory())},changePageView:function(){n(ImageDetailActions.changePageView(h.VisualSearch))},changeSelectedModule:function(t){var i=t?f[f.all]:f[f.productandads];n(ImageDetailActions.changeInsightsSelectedModule(i))},changeInsightsStatus:function(t){n(ImageDetailActions.changeInsightStatus(!0,t,"ObjectDetection"))},changeEnableSyntheticHotspotClick:function(t){n(ImageDetailActions.ChangeEnableSyntheticHotspotClick(t))},changeSelectedObjectIndex:function(t){typeof ImageDetailActions.changeSelectedObjectIndex!=r&&n(ImageDetailActions.changeSelectedObjectIndex(t))}}},v=function(n){var u=t.getCurrentResult(n),o=t.gpc().disAdltVs,s=o&&u&&u.isAdult?null:t.getDetectedObjects(n),f=t.getVisibleOverlayElements(n),h=f&&f.some(function(n){return n.type==c.Hotspot&&n.id==null}),e=t.getObjectDetectionConfig(n);return{detectedObjects:s,config:e,enableAllTabOnClick:e.EnableAllTabOnClick,detailScenario:t.getDetailScenario(n),showHotspotWithoutHover:h,imageData:u,viewType:t.getViewType(n),ig:t.getCurrentImpressionId(n),syntheticClick:typeof t.geshsc!=r?t.geshsc(n):i.None,selectedObjectIndex:typeof t.gsoi!=r?t.gsoi(n):-1}};n.ImageDetail.ObjectDetection=ReactRedux.connect(v,a)(l);n.ImageDetail.ObjectDetection.displayName="ObjectDetection"})(t=n.ImageDetail||(n.ImageDetail={}))}(Multimedia||(Multimedia={})),function(n){var t=function(){function n(n,t,i,r,u,f,e,o,s){var h=this;if(e===void 0&&(e=!0),o===void 0&&(o=5),s===void 0&&(s=!1),this.utils=pMMUtils,this.moved=!1,this.doubletap=!1,this.touchStartPoint=null,this.touchStartElementLeft=0,this.nowtouchpid=0,this.swipeDelta=null,this.touchStartTime=0,this.timeDelta=0,this.captureEvent=!0,this.enableEndHandlerWithoutMove=!1,this.moveSensitivity=5,this.cleanUp=function(){h.handleEventsSetting(!1)},this.isMoved=function(){return h.moved},this.resetMoved=function(){h.moved=!1},this.handleEventsSetting=function(n){var t=n?sj_be:sj_ue;typeof sb_de!="undefined"&&("ontouchstart"in sb_de?(t(h.touchElement,"touchstart",h.touchStart,h.captureEvent),t(h.touchElement,"touchmove",h.touchMove,h.captureEvent),t(h.touchElement,"touchend",h.touchEnd,h.captureEvent)):window.navigator.msPointerEnabled?(h.touchElement.style.msTouchAction="none",h.touchElement.style.touchAction="none",t(h.touchElement,"MSPointerDown",h.touchStart,h.captureEvent),t(h.touchElement,"MSPointerMove",h.touchMove,h.captureEvent),t(h.touchElement,"MSPointerUp",h.touchEnd,h.captureEvent),t(_d,"MSPointerUp",h.touchEnd,h.captureEvent)):"onpointermove"in sb_de&&(h.touchElement.style.msTouchAction="none",h.touchElement.style.touchAction="none",t(h.touchElement,"pointerdown",h.touchStart,h.captureEvent),t(h.touchElement,"pointermove",h.touchMove,h.captureEvent),t(h.touchElement,"pointerup",h.touchEnd,h.captureEvent),t(_d,"pointerup",h.touchEnd,h.captureEvent)),t(_d,"mousedown",h.resetMoved,!0))},this.getHandlerOrEmpty=function(n){return n!=null?n:h.Empty},this.Empty=function(){},this.setMoved=function(n){n===void 0&&(n=!1);h.moved=n},this.checkIfDoubleTap=function(){return sb_gt()-h.touchStartTime<250&&!!h.doubleTapHandler&&!h.isMoved()},this.touchStart=function(n){if(h.isTouchEvent(n)&&(h.doubletap=h.checkIfDoubleTap(),!h.doubletap)){h.setMoved(!1);h.touchStartPoint=h.getTouchPointFromEvent(n);var t=h.utils.gcs(h.touchElement);h.touchStartElementLeft=parseInt(typeof _G!="undefined"&&_G.RTL?t.marginRight:t.marginLeft);h.touchStartTime=sb_gt();!n.pointerId||(h.nowtouchpid=n.pointerId);h.touchStartHandler(n)}},this.touchMove=function(n){if(h.isTouchEvent(n)&&h.isValidTouch(n)){var t=h.getTouchPointFromEvent(n);if(!h.touchStartPoint||!t)return;h.swipeDelta=h.getDistanceBetweenPoints(h.touchStartPoint,t);h.setMoved(Math.abs(h.swipeDelta.X)>h.moveSensitivity||Math.abs(h.swipeDelta.Y)>h.moveSensitivity);h.isMoved()&&!h.doubletap&&h.touchMoveHandler(h.touchStartElementLeft,h.swipeDelta)&&h.preventDefault(n)}},this.touchEnd=function(n){var t=h.isMoved(),i;h.isTouchEvent(n)&&(h.doubletap&&!h.isMoved()?(h.doubleTapHandler(n),h.preventDefault(n),h.doubletap=!1):(t||h.enableEndHandlerWithoutMove)&&h.isValidTouch(n)&&(h.timeDelta=sb_gt()-h.touchStartTime,i=t?h.swipeDelta:h.getNewPoint(),h.touchEndHandler(h.touchStartElementLeft,i,h.timeDelta)&&h.preventDefault(n)),sj_ue(_d,"mousedown",h.resetMoved,!0),sb_st(function(){sj_be(_d,"mousedown",this.resetMoved,!0)},150))},this.preventDefault=function(n){n.stopPropagation();n.preventDefault()},this.getTouchPointFromEvent=function(n){var t=h.getNewPoint();return t.X=n.touches?n.touches[0].pageX:n.pageX!=undefined&&n.pageX!=0?n.pageX:0,t.Y=n.touches?n.touches[0].pageY:n.pageY!=undefined&&n.pageY!=0?n.pageY:0,t},this.getDistanceBetweenPoints=function(n,t){var i=h.getNewPoint();return i.X=t.X-n.X,i.Y=t.Y-n.Y,i},this.getNewPoint=function(){return{X:0,Y:0}},this.isTouchEvent=function(n){return typeof n.pointerType=="undefined"||n.pointerType==2||n.pointerType=="touch"||n.pointerType=="pen"},this.isValidTouch=function(n){return!n.pointerId||n.pointerId==h.nowtouchpid},!n)throw"container cannot be null!";this.container=n;this.touchElement=!t?this.container:t;this.touchStartHandler=this.getHandlerOrEmpty(i);this.touchMoveHandler=this.getHandlerOrEmpty(r);this.touchEndHandler=this.getHandlerOrEmpty(u);this.doubleTapHandler=this.getHandlerOrEmpty(f);this.enableEndHandlerWithoutMove=s;this.captureEvent=e;this.moveSensitivity=o;this.handleEventsSetting(!0)}return n}();n.MmReactSwipe=t}(ImageDetailSwipe||(ImageDetailSwipe={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}();__assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)},function(n){var t;(function(t){var f=n.InstrumentationUtils.lac,i=ImageDetailReducers,u="undefined",e=" selected",r=" show",o=" hide",s=" pr",h=function(i){function u(r){var u=i.call(this,r)||this;return u.hotspotInfo=n.TextRecognitionUtils.hotspotInfo,u.bboxInfo=n.TextRecognitionUtils.bboxInfo,u.compareBbox=n.TextRecognitionUtils.compareBbox,u.OcrRenderLevel=n.TextRecognitionUtils.OcrRenderLevel,u.defaultHotspotLocation=.05,u.fontScale=.7,u.epsilon=.01,u.regionElements=[],u.lineElements=[],u.wordElements=[],u.handleDragStartEvent=function(n){u.props.inTextMode&&u.enableDragSelection&&u.props.dragStart(n)},u.resetSelectedElements=function(n){var t=!1;return n.forEach(function(n){var i=u.renderSvg?n.className.baseVal:n.className;i.indexOf(e)>0&&(n.setAttribute("class",i.replace(e,"")),t=!0)}),t},u.refreshDataElements=function(){var n=!1;u.regionElements&&u.resetSelectedElements(u.regionElements)&&(n=!0);u.lineElements&&u.resetSelectedElements(u.lineElements)&&(n=!0);u.wordElements&&u.resetSelectedElements(u.wordElements)&&(n=!0);n&&u.props.changeSelectedTextIndex(null)},u.toggleTextMode=function(){u.props.inTextMode&&u.refreshDataElements();var n=u.props.inTextMode?!u.props.inTextMode:!0,t=n?"Enter":"Exit";f("TextMode",u.props.ig,{Action:t,Source:n?"hotspot":"close"});u.props.changeTextMode(n)},u.toPercentage=function(n){return n*100+"%"},u.toPixel=function(n,t,i){return n*t*i+"px"},u.toRadian=function(n){return"rotate("+n+"rad)"},u.createBbox=function(n,t,i,r,f){if(u.renderSvg){var e=n*100+i/2,o=t*100+r/2;return{x:u.toPercentage(n),y:u.toPercentage(t),width:u.toPercentage(i),height:u.toPercentage(r),transform:u.toRadian(Math.round(f*1e3)/1e3),transformOrigin:e+"% "+o+"%"}}return{left:u.toPercentage(n),top:u.toPercentage(t),width:u.toPercentage(i),height:u.toPercentage(r),fontSize:u.toPixel(r,u.props.imageHeight,u.fontScale),transform:u.toRadian(Math.round(f*1e3)/1e3),transformOrigin:"left top"}},u.selectText=function(n,t){var i=u.getOcrData(t),r=u.bboxInfo(i.boundingBox,i.text),e="left:"+r.left+", top:"+r.top,o={Text:r.text,Selected:!i.selected,Info:e};f("TextBoundingBox",u.props.ig,o);u.props.changeSelectedTextIndex(t)},u.renderTextBoxes=function(n){var i,r;switch(u.renderLevel){case u.OcrRenderLevel.Region:return u.props.ocrData.map(function(i,r){return React.createElement(t.TextRecognitionRegion,{key:r,region:i,dataIndex:{region:r},htmlElements:n=="mask"?null:u.regionElements,elementType:n,selected:i.selected,textEnabled:u.renderText,createBbox:u.createBbox,selectText:u.selectText})});case u.OcrRenderLevel.Line:return i=[],u.props.ocrData.map(function(r,f){r.lines.map(function(r,e){i.push(React.createElement(t.TextRecognitionLine,{key:f+"-"+e,line:r,dataIndex:{region:f,line:e},htmlElements:n=="mask"?null:u.lineElements,elementType:n,selected:r.selected,textEnabled:u.renderText,createBbox:u.createBbox,selectText:u.selectText}))})}),i;case u.OcrRenderLevel.Word:return r=[],u.props.ocrData.map(function(i,f){i.lines.map(function(i,e){i.words.map(function(i,o){r.push(React.createElement(t.TextRecognitionWord,{key:f+"-"+e+"-"+o,word:i,dataIndex:{region:f,line:e,word:o},htmlElements:n=="mask"?null:u.wordElements,elementType:n,selected:i.selected,textEnabled:u.renderText,createBbox:u.createBbox,selectText:u.selectText}))})})}),r}},u.props.ocrData||u.processOcrData(),u.props.config&&(u.showHotspotWithoutHover=r.config.shwoh,u.tooltipEnabled=r.config.te,u.renderLevel=r.config.rl,u.renderText=r.config.rt,u.renderSvg=r.config.rs,u.enableDragSelection=r.config.eds),u}return __extends(u,i),u.prototype.componentDidMount=function(){this.forceUpdate()},u.prototype.componentWillUpdate=function(){this.resetHtmlReferences()},u.prototype.componentDidUpdate=function(n){this.props.regions!=n.regions&&this.processOcrData()},u.prototype.resetHtmlReferences=function(){this.regionElements=[];this.lineElements=[];this.wordElements=[]},u.prototype.processOcrData=function(){var n=this,t;this.props.regions&&(t=this.props.regions.map(function(t){return t.selected=!1,t.lines.sort(function(t,i){return n.compareBbox(t.boundingBox,i.boundingBox,n.epsilon)}),t.lines=t.lines.map(function(t){return t.selected=!1,t.words.sort(function(t,i){return n.compareBbox(t.boundingBox,i.boundingBox,n.epsilon)}),t.words=t.words.map(function(n){return n.selected=!1,n}),t}),t}),this.props.sortOcrData(t))},u.prototype.getOcrData=function(n){return n.region>=0&&n.line>=0&&n.word>=0?this.props.ocrData[n.region].lines[n.line].words[n.word]:n.region>=0&&n.line>=0?this.props.ocrData[n.region].lines[n.line]:n.region>=0?this.props.ocrData[n.region]:void 0},u.prototype.render=function(){var n=this;if(this.props&&this.props.config&&this.props.config.e&&this.props.ocrData&&this.props.ocrData.length>0){var t="text_recognition_cont",i="text_mode_hotspot",u="close_text_mode",h="mask_container";(this.showHotspotWithoutHover||this.props.inTextMode||this.props.inTextModePreview)&&(t+=r);(this.props.inTextMode||this.props.inTextModePreview)&&(h+=r,this.props.inTextMode?(i+=o,u+=r):(i+=r,u+=o,t+=s));var c=this.props.config.tt,l=this.props.config.extm,v=this.tooltipEnabled?{"data-tooltip":c}:{title:c},y=this.tooltipEnabled?{"data-tooltip":l}:{title:l},f=this.props.ocrData[0].lines&&this.props.ocrData[0].lines.length>0?this.props.ocrData[0].lines[0]:null,e=f&&f.boundingBox&&this.hotspotInfo?this.hotspotInfo(f.boundingBox,this.props.imageHeight):null,p=e?{left:this.toPercentage(e.left),top:this.toPercentage(e.top)}:{left:this.toPercentage(this.defaultHotspotLocation),top:this.toPercentage(this.defaultHotspotLocation)},a={width:this.props.imageWidth,height:this.props.imageHeight};return React.createElement("div",{className:t,draggable:!0,onDragStart:this.handleDragStartEvent},React.createElement("span",__assign({},y,{className:u,onMouseDown:function(){return n.toggleTextMode()},onTouchEnd:function(){return n.toggleTextMode()}}),React.createElement("span",{className:"icon"})),React.createElement("span",__assign({},v,{className:i,style:p,onMouseDown:function(){return n.toggleTextMode()},onTouchEnd:function(){return n.toggleTextMode()}}),React.createElement("span",{className:"core"})),this.renderSvg?React.createElement("svg",{className:h,style:a},React.createElement("defs",null,React.createElement("mask",{id:"text_mode_mask"},React.createElement("rect",{className:"text_mode_opaque",x:"0",y:"0"}),React.createElement("g",null,this.renderTextBoxes("mask")))),React.createElement("rect",{className:"text_mode_bg",style:{x:"0",y:"0"},mask:"url(#text_mode_mask)"}),React.createElement("g",{id:"text_mode_borders"},this.renderTextBoxes("border"))):React.createElement("div",{style:a},this.renderTextBoxes()))}return null},u}(React.Component),c=function(n){return{changeTextMode:function(t){typeof ImageDetailActions.changeTextMode!=u&&n(ImageDetailActions.changeTextMode(t))},changeSelectedTextIndex:function(t){typeof ImageDetailActions.changeSelectedTextIndex!=u&&n(ImageDetailActions.changeSelectedTextIndex(t))},sortOcrData:function(t){typeof ImageDetailActions.sortOcrData!=u&&n(ImageDetailActions.sortOcrData(t))}}},l=function(n,t){return{config:i.gdlc("gtrc"),regions:i.getOcrText(n),inTextMode:i.getTextMode(n),ocrData:i.getSortedOcrData(n),imageHeight:t.imageHeight,imageWidth:t.imageWidth,ig:i.getCurrentImpressionId(n),inTextModePreview:i.getInTextModePreview(n)}};n.ImageDetail.TextRecognition=ReactRedux.connect(l,c)(h);n.ImageDetail.TextRecognition.displayName="TextRecognition"})(t=n.ImageDetail||(n.ImageDetail={}))}(Multimedia||(Multimedia={}))